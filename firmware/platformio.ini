[env:esp32dev]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200

; Library dependencies with specific versions and sources
lib_deps = 
    h2zero/NimBLE-Arduino @ ^1.4.1
    bblanchon/ArduinoJson @ ^6.21.3
    AsyncTCP=https://github.com/me-no-dev/AsyncTCP.git#master
    ESPAsyncWebServer=https://github.com/me-no-dev/ESPAsyncWebServer.git#master
    
; Build configuration
build_unflags = 
    -Os

build_flags =
    -O2
    -DASYNCWEBSERVER_REGEX
    -DCORE_DEBUG_LEVEL=5
    -DCONFIG_BT_NIMBLE_ROLE_PERIPHERAL_ENABLED=1
    -DCONFIG_BT_NIMBLE_ROLE_CENTRAL_ENABLED=1
    -DCONFIG_BT_NIMBLE_ROLE_BROADCASTER_ENABLED=1
    -DCONFIG_BT_NIMBLE_ROLE_OBSERVER_ENABLED=1
    -DCONFIG_BT_NIMBLE_NVS_PERSIST=1
    -DCONFIG_BT_NIMBLE_SECURITY_ENABLE=1

; Library configuration for better dependency handling
lib_ldf_mode = deep+
lib_compat_mode = soft

upload_speed = 921600

; Enable task watchdog for better stability
board_build.partitions = huge_app.csv

; Development configuration
monitor_filters = esp32_exception_decoder
monitor_rts = 0
monitor_dtr = 0

; Custom Serial port can be defined here
; upload_port = COM3
; monitor_port = COM3

; Extra build configurations
extra_scripts = pre:preBuild.py
